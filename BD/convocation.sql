-- phpMyAdmin SQL Dump
-- version 5.0.2
-- https://www.phpmyadmin.net/
--
-- Hôte : localhost
-- Version du serveur :  10.5.8-MariaDB
-- Version de PHP : 7.4.5

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

DROP TABLE IF EXISTS T_ABSENCE;
DROP TABLE IF EXISTS T_CONVOCATION;
DROP TABLE IF EXISTS T_MATCH;
DROP TABLE IF EXISTS T_JOUEUR;
DROP TABLE IF EXISTS T_EQUIPE;
DROP TABLE IF EXISTS T_COMPETITION;
DROP TABLE IF EXISTS T_CATEGORIE;
DROP TABLE IF EXISTS T_UTILISATEUR;


CREATE TABLE T_UTILISATEUR (
    Username VARCHAR(50),
    Password VARCHAR(50),
    Role VARCHAR(30) CHECK (Role in ('entraineur','secretaire')),
    PRIMARY KEY (Username,Password)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE T_CATEGORIE (
    Nom VARCHAR(50),
    PRIMARY KEY (Nom)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE T_COMPETITION (
   Nom VARCHAR(100),
   PRIMARY KEY (Nom)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE T_EQUIPE (
    Nom VARCHAR(100),
    PRIMARY KEY (Nom)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- TODO : voir si on met Licencié ou TypeLicence (libre, etc. - mieux?) default NULL
CREATE TABLE T_JOUEUR (
	IdJoueur int NOT NULL AUTO_INCREMENT,
    Nom VARCHAR(30) NOT NULL,
    Prenom VARCHAR(30) NOT NULL,
    Categorie VARCHAR(50),
    Licencie CHAR(3) DEFAULT 'non' CHECK (Licencie IN ('oui','non')),
    PRIMARY KEY (IdJoueur),
    FOREIGN KEY (Categorie) REFERENCES T_CATEGORIE(Nom) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;


CREATE TABLE T_MATCH (
	NumMatch int NOT NULL AUTO_INCREMENT,
    Categorie VARCHAR(50),
    Competition VARCHAR(100) NOT NULL,
    Equipe VARCHAR(30) NOT NULL,
    EquipeAdverse VARCHAR(30) NOT NULL,
    Date DATE NOT NULL,
    Heure CHAR(5) NOT NULL,
    Terrain VARCHAR(100),
    Site VARCHAR(30),
    PRIMARY KEY (NumMatch),
    FOREIGN KEY (Categorie) REFERENCES T_CATEGORIE(Nom),
    FOREIGN KEY (Competition) REFERENCES T_COMPETITION(Nom),
    FOREIGN KEY (Equipe) REFERENCES T_EQUIPE(Nom)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- 1 convoc = 1 match et un joueur qui participe
-- pour un même numMatch on aura donc entre 11 et 14 joueurs associés (= joueurs de l'équipe selectionnée)
CREATE TABLE T_CONVOCATION (
    NumConvoc int AUTO_INCREMENT,
    NumMatch int,
    IdJoueur int,
    Publie boolean DEFAULT FALSE,
    PRIMARY KEY (NumConvoc),
    FOREIGN KEY (NumMatch) REFERENCES T_MATCH(NumMatch) ,
    FOREIGN KEY (IdJoueur) REFERENCES T_JOUEUR(IdJoueur)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;


CREATE TABLE T_ABSENCE (
	IdJoueur int,
	Date DATE,
	Motif VARCHAR(30),
	PRIMARY KEY (IdJoueur,Date),
    FOREIGN KEY (IdJoueur) REFERENCES T_JOUEUR(IdJoueur) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
COMMIT;

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
